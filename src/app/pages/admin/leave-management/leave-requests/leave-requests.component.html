<div class="flex h-screen bg-gray-50">
    <!-- Sidebar -->
    <app-sidebar></app-sidebar>
  
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Header -->
      <app-header 
      [breadcrumbs]="breadcrumbs"
      title="Leave Requests"
    ></app-header>
    
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6">

<div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
  <div class="px-6 py-4 border-b border-gray-200">
    <h3 class="text-lg font-medium text-gray-900">Leave Requests</h3>
    <p class="text-sm text-gray-600 mt-1 leading-relaxed">Comprehensive leave request management system. Review, approve, or reject employee leave applications with detailed information and supporting documents. Monitor leave balances, track request statuses, and ensure proper approval workflows. Filter requests by employee, department, or status to efficiently manage your organization's leave processes. View detailed request information including dates, reasons, and attached documentation to make informed approval decisions.</p>
  </div>
  <div class="p-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
    <div class="flex flex-col md:flex-row gap-4">
      <div>
        <label class="block text-xs font-medium text-gray-500 uppercase mb-1">Employee</label>
        <input type="text" [(ngModel)]="filter.employee" placeholder="Search by name or ID" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" />
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-500 uppercase mb-1">Department</label>
        <input type="text" [(ngModel)]="filter.department" placeholder="Search by department" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" />
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-500 uppercase mb-1">Status</label>
        <select [(ngModel)]="filter.status" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          <option value="">All Statuses</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>
    </div>
    <div class="flex gap-2">
      <button class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors" (click)="clearFilters()">Clear</button>
      <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors" (click)="filterRequests()">Filter</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
  </div>

  <div *ngIf="!isLoading" class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Leave Type</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Start</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">End</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Document</th>
          <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let request of leaveRequests" class="hover:bg-gray-50">
          <td class="px-4 py-2">{{ getEmployeeName(request) }}<br><span class="text-xs text-gray-400">{{ getEmployeeId(request) }}</span></td>
          <td class="px-4 py-2">{{ getEmployeeDepartment(request) }}</td>
          <td class="px-4 py-2">{{ getLeaveTypeName(request.leaveTypeId) }}</td>
          <td class="px-4 py-2">{{ request.startDate | date:'shortDate' }}</td>
          <td class="px-4 py-2">{{ request.endDate | date:'shortDate' }}</td>
          <td class="px-4 py-2">
            <span [ngClass]="{
              'px-2 py-1 text-xs font-medium rounded-full': true,
              'bg-yellow-100 text-yellow-800': request.status === 'pending',
              'bg-green-100 text-green-800': request.status === 'approved',
              'bg-red-100 text-red-800': request.status === 'rejected'
            }">{{ request.status | titlecase }}</span>
          </td>
          <td class="px-4 py-2">{{ request.reason }}</td>
          <td class="px-4 py-2">
            <div class="flex items-center">
              <ng-container *ngIf="request.docUrl; else noFiles">
                <a 
                  [href]="request.docUrl" 
                  target="_blank" 
                  class="inline-flex items-center text-blue-600 hover:text-blue-900 transition-colors duration-200"
                  title="View Document"
                >
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                  </svg>
                  <span class="text-sm">View</span>
                </a>
              </ng-container>
              <ng-template #noFiles>
                <span class="text-gray-400 text-sm flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  None
                </span>
              </ng-template>
            </div>
          </td>
          <td class="px-4 py-2 text-right">
            <div class="flex items-center justify-end space-x-2">
              <!-- View Details Button -->
              <button 
                (click)="viewRequestDetails(request)" 
                class="text-blue-600 hover:text-blue-900 transition-colors duration-200"
                title="View Request Details"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
              </button>
              
              <!-- Approve Button -->
              <button 
                *ngIf="request.status === 'pending'" 
                (click)="approveRequest(request)" 
                class="text-green-600 hover:text-green-900 transition-colors duration-200"
                title="Approve Leave Request"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </button>
              
              <!-- Reject Button -->
              <button 
                *ngIf="request.status === 'pending'" 
                (click)="rejectRequest(request)" 
                class="text-red-600 hover:text-red-900 transition-colors duration-200"
                title="Reject Leave Request"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- Empty State -->
    <div *ngIf="leaveRequests.length === 0" class="text-center py-12">
      <p class="text-gray-500">No leave requests found.</p>
    </div>
  </div>
  </div>
</div>

    </main>
  </div>
</div>

<!-- Leave Request Details Modal -->
<div *ngIf="showDetailsModal" class="fixed inset-0 z-50 flex items-center justify-center">
  <div class="absolute inset-0 bg-black/40" (click)="closeDetailsModal()"></div>
  <div class="relative w-full max-w-2xl bg-white rounded-lg shadow-lg">
    <div class="flex items-center justify-between px-5 py-3 border-b">
      <h3 class="text-lg font-semibold text-gray-900">Leave Request Details</h3>
      <button (click)="closeDetailsModal()" class="text-gray-500 hover:text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="p-5 space-y-4">
      <!-- Employee Information -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Employee Name</label>
          <p class="text-sm text-gray-900">{{ selectedRequest?.employee?.firstName }} {{ selectedRequest?.employee?.lastName }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Employee ID</label>
          <p class="text-sm text-gray-900">{{ selectedRequest?.employee?.employeeId }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
          <p class="text-sm text-gray-900">{{ selectedRequest ? getEmployeeDepartment(selectedRequest) : '' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Leave Type</label>
          <p class="text-sm text-gray-900">{{ selectedRequest && selectedRequest.leaveTypeId !== undefined ? getLeaveTypeName(selectedRequest.leaveTypeId) : '' }}</p>
        </div>
      </div>

      <!-- Leave Dates -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
          <p class="text-sm text-gray-900">{{ selectedRequest?.startDate | date:'mediumDate' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
          <p class="text-sm text-gray-900">{{ selectedRequest?.endDate | date:'mediumDate' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Total Days</label>
          <p class="text-sm text-gray-900">{{ selectedRequest && selectedRequest.startDate && selectedRequest.endDate ? calculateInclusiveDays(selectedRequest.startDate, selectedRequest.endDate) : 0 }} days</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
          <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full" [ngClass]="{
            'bg-yellow-100 text-yellow-800': selectedRequest?.status === 'pending',
            'bg-green-100 text-green-800': selectedRequest?.status === 'approved',
            'bg-red-100 text-red-800': selectedRequest?.status === 'rejected'
          }">{{ selectedRequest?.status | titlecase }}</span>
        </div>
      </div>

      <!-- Reason and Document -->
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Reason</label>
          <p class="text-sm text-gray-900 bg-gray-50 p-3 rounded-md">{{ selectedRequest?.reason }}</p>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Document</label>
          <div *ngIf="selectedRequest?.docUrl; else noDocument" class="flex items-center">
            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
            </svg>
            <a 
              [href]="selectedRequest?.docUrl" 
              target="_blank" 
              class="text-blue-600 hover:text-blue-900 underline"
            >
              View Document
            </a>
          </div>
          <ng-template #noDocument>
            <p class="text-sm text-gray-500 flex items-center">
              <svg class="w-5 h-5 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              No document attached
            </p>
          </ng-template>
        </div>
      </div>

      <!-- Action Buttons for Pending Requests -->
      <div *ngIf="selectedRequest?.status === 'pending'" class="flex justify-end space-x-3 pt-4 border-t">
        <button 
          (click)="handleModalAction('approve')" 
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Approve Request
        </button>
        <button 
          (click)="handleModalAction('reject')" 
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Reject Request
        </button>
      </div>
    </div>
    
    <div class="flex justify-end px-5 py-3 border-t bg-gray-50">
      <button 
        (click)="closeDetailsModal()" 
        class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
      >
        Close
      </button>
    </div>
  </div>
</div>
